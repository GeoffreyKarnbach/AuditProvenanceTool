# API Reference & Data Contracts

This document provides a consolidated reference for all REST API endpoints and the primary data structures (DTOs) that flow between the services. Understanding these data contracts is essential for developing or integrating with the system.

All endpoints share a common base path of `/api/v1/`.

## Director Managing Service

This service acts as the central orchestrator and is the primary point of contact for the frontend.

**Base Path:** `/api/v1/workflow`

| Method | Path                                           | Description                                                                   | Request Body / Parts                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Success Response                                                                                                                                                                                                                                                                                                           |
| :----- | :--------------------------------------------- | :---------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `POST` | `/`                                            | Initiates the workflow.                                                       | `multipart/form-data` with parts: <br>- `ttlFile` (file) <br>- `txtFile` (file)                                                                                                                                                                                                                                                                                                                                                                                                | A `string` containing the unique `processId`.                                                                                                                                                                                                                                                                              |
| `GET`  | `/...-complete/{processId}`                    | Pollable endpoints to check task status (`ttl-analyze`, `txt-analyze`, etc.). | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | A `boolean` (`true` or `false`).                                                                                                                                                                                                                                                                                           |
| `POST` | `/trigger-unification-workflow/{processId}`    | Triggers Phase 1 of the unification process.                                  | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | A `boolean`.                                                                                                                                                                                                                                                                                                               |
| `GET`  | `/unification-first-step-response/{processId}` | Retrieves the clarification suggestions for the frontend.                     | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | A JSON object (`UnificationClarificationManagingRequestDTO`). <details><summary>Click to see DTO</summary>`java // Java DTO from Director public class UnificationClarificationManagingRequestDTO { private Workflow workflow; private UnificationClarificationResponseDTO unificationClarificationResponse; } `</details> |
| `POST` | `/trigger-output-generation/{processId}`       | Finalizes the workflow using the user's choices.                              | A JSON body (`UnificationClarificationFrontendResponseDto`). <details><summary>Click to see DTO</summary>`java // Java DTO public class UnificationClarificationFrontendResponseDTO { private String requestId; private List<UnificationClarificationSelectionItemDto> items; } class UnificationClarificationSelectionItemDto { private String question; private String selectedActivityId; private String selectedEntityId; private String selectedTraceValue; } `</details> | A `boolean`.                                                                                                                                                                                                                                                                                                               |
| `GET`  | `/output-generation-response/{processId}`      | Downloads the final `output.zip` archive.                                     | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | An `application/zip` file.                                                                                                                                                                                                                                                                                                 |

---

## AI System Analyzer Service

Parses the `.ttl` file into a structured `Workflow` object.

**Base Path:** `/api/v1/workflow-mapping`

| Method | Path | Description             | Request Body / Parts                                 | Success Response                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :----- | :--- | :---------------------- | :--------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `POST` | `/`  | Parses the `.ttl` file. | `multipart/form-data` with part: <br>- `file` (file) | A JSON object representing the `Workflow`. <details><summary>Click to see DTO (TypeScript)</summary>`typescript // TypeScript representation used by the Frontend export interface WorkflowDTO { workflowSteps: WorkflowStepDTO[]; workflowAgents: WorkflowAgentDTO[]; workflowVariables: WorkflowVariableDTO[]; } export interface WorkflowStepDTO { id: string; stepName: string; stepNumber: number; previousStepId: string; nextStepId: string; workflowAgents: WorkflowAgentDTO[]; workflowInputVariables: WorkflowVariableDTO[]; workflowOutputVariables: WorkflowVariableDTO[]; stepSubtype: string; defaultTraceFields: string[]; } // ...and so on for WorkflowAgentDTO and WorkflowVariableDTO `</details> |

---

## PQ Analyzer Service

Analyzes natural language questions.

**Base Path:** `/api/v1/pq-analyzer`

| Method | Path | Description                            | Request Body / Parts                                 | Success Response                                                                                                                                                                                                                                                                                                                                                                                                                              |
| :----- | :--- | :------------------------------------- | :--------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `POST` | `/`  | Analyzes the `.txt` file of questions. | `multipart/form-data` with part: <br>- `file` (file) | A JSON array of `PQAnalyzerResponseItemDTO` objects. <details><summary>Click to see DTO</summary>`java // Java DTO public class PQAnalyzerResponseItemDTO { private String original_question; private List<List<String>> tokens; private List<Object> patterns; private String rewritten_question; private List<String> formalized_question; private List<Object> target_concept; private Map<String, String> mapped_to_prov_o; } `</details> |

---

## Unification Generation Service

Merges outputs and generates final artifacts.

**Base Path:** `/api/v1/`

| Method | Path                                   | Description                                                 | Request Body / Parts                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Success Response                                                                                                                                                                                                                                                                                                                                                                       |
| :----- | :------------------------------------- | :---------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `POST` | `/unification-first-step/{request_id}` | **Initiates Phase 1.** Generates clarification suggestions. | `multipart/form-data` with parts: <br>- `ai_system_analyzer` (a `Workflow` JSON file) <br>- `pq_analyzer` (an array of `PQAnalyzerResponseItemDTO` JSON file)                                                                                                                                                                                                                                                                                                                                | A JSON object (`UnificationClarificationResponseDTO`). <details><summary>Click to see DTO</summary>`java // Java DTO public class UnificationClarificationResponseDTO { private List<PossibleActivityDto> options; private List<MappingItemDto> mappingSuggestions; private String requestId; } class MappingItemDto { /* ... */ } class PossibleActivityDto { /* ... */ } `</details> |
| `POST` | `/unification-response/{request_id}`   | **Initiates Phase 2.** Generates the final artifacts.       | A JSON body (`UnificationClarificationFrontendResponseDto`). <details><summary>Click to see DTO</summary>`typescript // TypeScript interface sent from Frontend export interface UnificationClarificationFrontendResponseDto { requestId: string; items: UnificationClarificationSelectionItemDto[]; } export interface UnificationClarificationSelectionItemDto { question: string; selectedActivityId: string; selectedEntityId: string; selectedTraceValue: string \| null; } `</details> | An `application/zip` file.                                                                                                                                                                                                                                                                                                                                                             |
